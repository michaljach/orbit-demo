{"id":"../node_modules/orbit-db-eventstore/src/EventStore.js","dependencies":[{"name":"/Users/michaljach/Sites/golf/package.json","includedInParent":true,"mtime":1612444349509},{"name":"/Users/michaljach/Sites/golf/node_modules/orbit-db-eventstore/package.json","includedInParent":true,"mtime":1612441747439},{"name":"orbit-db-store","loc":{"line":3,"column":22},"parent":"/Users/michaljach/Sites/golf/node_modules/orbit-db-eventstore/src/EventStore.js","resolved":"/Users/michaljach/Sites/golf/node_modules/orbit-db-store/src/Store.js"},{"name":"./EventIndex","loc":{"line":4,"column":27},"parent":"/Users/michaljach/Sites/golf/node_modules/orbit-db-eventstore/src/EventStore.js","resolved":"/Users/michaljach/Sites/golf/node_modules/orbit-db-eventstore/src/EventIndex.js"}],"generated":{"js":"'use strict'\n\nconst Store = require('orbit-db-store')\nconst EventIndex = require('./EventIndex')\n\n// TODO: generalize the Iterator functions and spin to its own module\n\nclass EventStore extends Store {\n  constructor (ipfs, id, dbname, options = {}) {\n    if (options.Index === undefined) Object.assign(options, { Index: EventIndex })\n    super(ipfs, id, dbname, options)\n    this._type = 'eventlog';\n    this.events.on(\"log.op.ADD\", (address, hash, payload) => {\n      this.events.emit(\"db.append\", payload.value)\n    })\n  }\n\n  add (data, options = {}) {\n    return this._addOperation({\n      op: 'ADD',\n      key: null,\n      value: data\n    }, options)\n  }\n\n  get (hash) {\n    return this.iterator({ gte: hash, limit: 1 }).collect()[0]\n  }\n  iterator (options) {\n    const messages = this._query(options)\n    let currentIndex = 0\n    let iterator = {\n      [Symbol.iterator] () {\n        return this\n      },\n      next () {\n        let item = { value: null, done: true }\n        if (currentIndex < messages.length) {\n          item = { value: messages[currentIndex], done: false }\n          currentIndex++\n        }\n        return item\n      },\n      collect: () => messages\n    }\n\n    return iterator\n  }\n\n  _query (opts) {\n    if (!opts) opts = {}\n\n    const amount = opts.limit ? (opts.limit > -1 ? opts.limit : this._index.get().length) : 1 // Return 1 if no limit is provided\n    const events = this._index.get().slice()\n    let result = []\n\n    if (opts.gt || opts.gte) {\n      // Greater than case\n      result = this._read(events, opts.gt ? opts.gt : opts.gte, amount, !!opts.gte)\n    } else {\n      // Lower than and lastN case, search latest first by reversing the sequence\n      result = this._read(events.reverse(), opts.lt ? opts.lt : opts.lte, amount, opts.lte || !opts.lt).reverse()\n    }\n    \n    if (opts.reverse) {\n      result.reverse()\n    }\n\n    return result\n  }\n\n  _read (ops, hash, amount, inclusive) {\n    // Find the index of the gt/lt hash, or start from the beginning of the array if not found\n    const index = ops.map((e) => e.hash).indexOf(hash)\n    let startIndex = Math.max(index, 0)\n    // If gte/lte is set, we include the given hash, if not, start from the next element\n    startIndex += inclusive ? 0 : 1\n    // Slice the array to its requested size\n    const res = ops.slice(startIndex).slice(0, amount)\n    return res\n  }\n}\n\nmodule.exports = EventStore\n"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":2,"column":0},"generated":{"line":2,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":3,"column":0},"generated":{"line":3,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":4,"column":0},"generated":{"line":4,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":5,"column":0},"generated":{"line":5,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":6,"column":0},"generated":{"line":6,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":7,"column":0},"generated":{"line":7,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":8,"column":0},"generated":{"line":8,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":9,"column":0},"generated":{"line":9,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":10,"column":0},"generated":{"line":10,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":11,"column":0},"generated":{"line":11,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":12,"column":0},"generated":{"line":12,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":13,"column":0},"generated":{"line":13,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":14,"column":0},"generated":{"line":14,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":15,"column":0},"generated":{"line":15,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":16,"column":0},"generated":{"line":16,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":17,"column":0},"generated":{"line":17,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":18,"column":0},"generated":{"line":18,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":19,"column":0},"generated":{"line":19,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":20,"column":0},"generated":{"line":20,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":21,"column":0},"generated":{"line":21,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":22,"column":0},"generated":{"line":22,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":23,"column":0},"generated":{"line":23,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":24,"column":0},"generated":{"line":24,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":25,"column":0},"generated":{"line":25,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":26,"column":0},"generated":{"line":26,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":27,"column":0},"generated":{"line":27,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":28,"column":0},"generated":{"line":28,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":29,"column":0},"generated":{"line":29,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":30,"column":0},"generated":{"line":30,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":31,"column":0},"generated":{"line":31,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":32,"column":0},"generated":{"line":32,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":33,"column":0},"generated":{"line":33,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":34,"column":0},"generated":{"line":34,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":35,"column":0},"generated":{"line":35,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":36,"column":0},"generated":{"line":36,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":37,"column":0},"generated":{"line":37,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":38,"column":0},"generated":{"line":38,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":39,"column":0},"generated":{"line":39,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":40,"column":0},"generated":{"line":40,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":41,"column":0},"generated":{"line":41,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":42,"column":0},"generated":{"line":42,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":43,"column":0},"generated":{"line":43,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":44,"column":0},"generated":{"line":44,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":45,"column":0},"generated":{"line":45,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":46,"column":0},"generated":{"line":46,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":47,"column":0},"generated":{"line":47,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":48,"column":0},"generated":{"line":48,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":49,"column":0},"generated":{"line":49,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":50,"column":0},"generated":{"line":50,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":51,"column":0},"generated":{"line":51,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":52,"column":0},"generated":{"line":52,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":53,"column":0},"generated":{"line":53,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":54,"column":0},"generated":{"line":54,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":55,"column":0},"generated":{"line":55,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":56,"column":0},"generated":{"line":56,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":57,"column":0},"generated":{"line":57,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":58,"column":0},"generated":{"line":58,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":59,"column":0},"generated":{"line":59,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":60,"column":0},"generated":{"line":60,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":61,"column":0},"generated":{"line":61,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":62,"column":0},"generated":{"line":62,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":63,"column":0},"generated":{"line":63,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":64,"column":0},"generated":{"line":64,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":65,"column":0},"generated":{"line":65,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":66,"column":0},"generated":{"line":66,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":67,"column":0},"generated":{"line":67,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":68,"column":0},"generated":{"line":68,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":69,"column":0},"generated":{"line":69,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":70,"column":0},"generated":{"line":70,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":71,"column":0},"generated":{"line":71,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":72,"column":0},"generated":{"line":72,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":73,"column":0},"generated":{"line":73,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":74,"column":0},"generated":{"line":74,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":75,"column":0},"generated":{"line":75,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":76,"column":0},"generated":{"line":76,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":77,"column":0},"generated":{"line":77,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":78,"column":0},"generated":{"line":78,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":79,"column":0},"generated":{"line":79,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":80,"column":0},"generated":{"line":80,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":81,"column":0},"generated":{"line":81,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":82,"column":0},"generated":{"line":82,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":83,"column":0},"generated":{"line":83,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":84,"column":0},"generated":{"line":84,"column":0}},{"source":"../node_modules/orbit-db-eventstore/src/EventStore.js","original":{"line":85,"column":0},"generated":{"line":85,"column":0}}],"sources":{"../node_modules/orbit-db-eventstore/src/EventStore.js":"'use strict'\n\nconst Store = require('orbit-db-store')\nconst EventIndex = require('./EventIndex')\n\n// TODO: generalize the Iterator functions and spin to its own module\n\nclass EventStore extends Store {\n  constructor (ipfs, id, dbname, options = {}) {\n    if (options.Index === undefined) Object.assign(options, { Index: EventIndex })\n    super(ipfs, id, dbname, options)\n    this._type = 'eventlog';\n    this.events.on(\"log.op.ADD\", (address, hash, payload) => {\n      this.events.emit(\"db.append\", payload.value)\n    })\n  }\n\n  add (data, options = {}) {\n    return this._addOperation({\n      op: 'ADD',\n      key: null,\n      value: data\n    }, options)\n  }\n\n  get (hash) {\n    return this.iterator({ gte: hash, limit: 1 }).collect()[0]\n  }\n  iterator (options) {\n    const messages = this._query(options)\n    let currentIndex = 0\n    let iterator = {\n      [Symbol.iterator] () {\n        return this\n      },\n      next () {\n        let item = { value: null, done: true }\n        if (currentIndex < messages.length) {\n          item = { value: messages[currentIndex], done: false }\n          currentIndex++\n        }\n        return item\n      },\n      collect: () => messages\n    }\n\n    return iterator\n  }\n\n  _query (opts) {\n    if (!opts) opts = {}\n\n    const amount = opts.limit ? (opts.limit > -1 ? opts.limit : this._index.get().length) : 1 // Return 1 if no limit is provided\n    const events = this._index.get().slice()\n    let result = []\n\n    if (opts.gt || opts.gte) {\n      // Greater than case\n      result = this._read(events, opts.gt ? opts.gt : opts.gte, amount, !!opts.gte)\n    } else {\n      // Lower than and lastN case, search latest first by reversing the sequence\n      result = this._read(events.reverse(), opts.lt ? opts.lt : opts.lte, amount, opts.lte || !opts.lt).reverse()\n    }\n    \n    if (opts.reverse) {\n      result.reverse()\n    }\n\n    return result\n  }\n\n  _read (ops, hash, amount, inclusive) {\n    // Find the index of the gt/lt hash, or start from the beginning of the array if not found\n    const index = ops.map((e) => e.hash).indexOf(hash)\n    let startIndex = Math.max(index, 0)\n    // If gte/lte is set, we include the given hash, if not, start from the next element\n    startIndex += inclusive ? 0 : 1\n    // Slice the array to its requested size\n    const res = ops.slice(startIndex).slice(0, amount)\n    return res\n  }\n}\n\nmodule.exports = EventStore\n"},"lineCount":85}},"error":null,"hash":"0d17cc51476bc6cc0b90888df82f36e0","cacheData":{"env":{}}}